{"version":3,"sources":["webpack:///./src/templates/Auth/SignUp.js"],"names":["StyledSignUp","styled","section","props","theme","breakpoints","desktopSmall","Container","div","desktopVw","StyledButton","Button","SignUp","location","page","data","contentfulAuthenticationPage","loginUser","useLoginUser","useForm","register","handleSubmit","errors","useState","stage","setStage","serverError","setServerError","email","setEmail","loading","setLoading","getRedirectURL","query","redirecturi","queryString","parse","signUp","a","name","family_name","username","password","Auth","attributes","eventTracker","trackClick","EventType","FORM_SUBMIT","trackInternal","category","action","context","login_email","lb_user_id","getCookie","ANALYTIC_COOKIES","LB_USER_ID","navigate","code","message","indexOf","captureException","type","API","image","onSubmit","documentToReactComponents","formHeader","json","dangerouslySetInnerHTML","__html","placeholder","required","black","buttonText","search","to","trackParams","SignUpQuery"],"mappings":"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","file":"component---src-templates-auth-sign-up-js-00e7c06694c12ea6970c.js","sourcesContent":["import React, { useState } from 'react'\nimport styled from 'styled-components'\nimport { graphql } from 'gatsby'\nimport { documentToReactComponents } from '@contentful/rich-text-react-renderer'\nimport { Auth } from 'aws-amplify'\nimport { useForm } from 'react-hook-form'\n\nimport queryString from 'query-string'\nimport { navigate } from '@reach/router'\nimport { desktopVw } from '../../styles/utils'\n\nimport AuthWrapper from '../../components/Auth/AuthWrapper'\nimport FormHeader from '../../components/Auth/FormHeader'\nimport FormFooter from '../../components/Auth/FormFooter'\n\nimport {\n  Input,\n  Password,\n  BoxStyledErrorMessage,\n} from '../../components/FormElements'\nimport Button from '../../components/Button'\nimport eventTracker from '../../trackers/EventTracker'\nimport EventType from '../../trackers/eventType'\nimport { getCookie } from '../../utils'\nimport TrackableLink from '../../components/TrackableLink'\nimport { captureException } from '../../components/Sentry/utils'\nimport useLoginUser from '../../hooks/useLoginUser'\nimport { ANALYTIC_COOKIES } from '../../utils/constants'\n\nconst StyledSignUp = styled.section`\n  @media (min-width: ${props => props.theme.breakpoints.desktopSmall}px) {\n  }\n`\n\nconst Container = styled.div`\n  margin-bottom: 20px;\n\n  @media (min-width: ${props => props.theme.breakpoints.desktopSmall}px) {\n    margin-bottom: ${desktopVw(20)};\n  }\n`\n\nconst StyledButton = styled(Button)`\n  display: block;\n  width: 100%;\n  font-size: 20px;\n  padding: 22px;\n\n  @media (min-width: ${props => props.theme.breakpoints.desktopSmall}px) {\n    font-size: ${desktopVw(20)};\n    padding: ${desktopVw(22)};\n  }\n`\n\nconst ButtonWrapper = styled.div`\n  @media (min-width: ${props => props.theme.breakpoints.desktopSmall}px) {\n    margin-top: ${desktopVw(40)};\n  }\n`\n\nconst SignUp = ({ location, data }) => {\n  const page = data.contentfulAuthenticationPage\n  const { loginUser } = useLoginUser()\n  const { register, handleSubmit, errors } = useForm()\n  const [stage, setStage] = useState(0)\n  const [serverError, setServerError] = useState(null)\n  const [email, setEmail] = useState(null)\n  const [loading, setLoading] = useState(false)\n\n  const getRedirectURL = query => {\n    if (query) {\n      const queryParams = queryString.parse(query)\n      const { redirecturi } = queryParams\n      if (redirecturi) {\n        return redirecturi\n      }\n      return null\n    }\n    return null\n  }\n\n  const signUp = async data => {\n    const { name, family_name, username, password } = data\n    setEmail(username)\n    try {\n      setLoading(true)\n      await Auth.signUp({\n        username,\n        password,\n        attributes: {\n          name,\n          family_name,\n          email: username,\n        },\n      })\n      setStage(1)\n      eventTracker.trackClick(EventType.FORM_SUBMIT, {\n        trackInternal: true,\n        category: 'login',\n        action: 'account_create',\n        context: {\n          login_email: username,\n          lb_user_id: getCookie(ANALYTIC_COOKIES.LB_USER_ID),\n        },\n      })\n      await loginUser(username, password)\n      setLoading(false)\n      navigate('/account/my-orders-returns')\n    } catch (err) {\n      setLoading(false)\n      // Identify few cases and provide a human readable exception to the user\n      if (err && err.code == 'InvalidParameterException') {\n        if (err.message && err.message.indexOf('password') > -1) {\n          err.message = 'Password must be atleast 8 characters in length'\n        }\n      }\n      if (err && err.code == 'InvalidPasswordException') {\n        if (err.message && err.message.indexOf('not long') > -1) {\n          err.message = 'Password must be atleast 8 characters in length'\n        }\n      }\n      if (err && err.code == 'UsernameExistsException') {\n        err.message =\n          'An account with the given email already exists. Please <a href=\"/log-in\" style=\"text-decoration:underline; font-weight: 500;\">Log in</a>.'\n      }\n      setServerError(err)\n\n      captureException(\n        err,\n        { username },\n        { type: 'API_FAILURE', API: 'SIGNUP' },\n      )\n    }\n  }\n\n  return (\n    <StyledSignUp>\n      <AuthWrapper image={page.image}>\n        {stage === 0 && (\n          <form onSubmit={handleSubmit(signUp)}>\n            <FormHeader>\n              {documentToReactComponents(page.formHeader.json)}\n            </FormHeader>\n            {serverError && (\n              <BoxStyledErrorMessage\n                dangerouslySetInnerHTML={{ __html: serverError.message }}\n              />\n            )}\n            <Container>\n              <Input\n                type='text'\n                placeholder='First name'\n                name='name'\n                required\n                register={register}\n                errors={errors}\n              />\n            </Container>\n            <Container>\n              <Input\n                type='text'\n                placeholder='Last name'\n                name='family_name'\n                required\n                register={register}\n                errors={errors}\n              />\n            </Container>\n            <Container>\n              <Input\n                type='email'\n                placeholder='Email'\n                name='username'\n                required\n                register={register}\n                errors={errors}\n              />\n            </Container>\n            <Container>\n              <Password\n                placeholder='Password'\n                name='password'\n                required\n                register={register}\n                errors={errors}\n              />\n            </Container>\n            <Container>\n              <StyledButton black type='submit' loading={loading}>\n                {page.buttonText}\n              </StyledButton>\n            </Container>\n          </form>\n        )}\n        {stage === 1 && (\n          <FormHeader>\n            <h1>Welcome to Quince!</h1>\n            <h3>Account successfully created. Logging you in...</h3>\n          </FormHeader>\n        )}\n        {stage < 1 && (\n          <FormFooter>\n            <p>\n              Already have an account?{' '}\n              {getRedirectURL(location.search) ? (\n                <TrackableLink\n                  to={`/log-in?redirecturi=${getRedirectURL(location.search)}`}\n                  trackParams={{\n                    trackInternal: true,\n                    category: 'login',\n                    action: 'click_already_have_account',\n                    context: {\n                      login_email: email || '',\n                      lb_user_id: getCookie(ANALYTIC_COOKIES.LB_USER_ID),\n                    },\n                  }}\n                >\n                  login\n                </TrackableLink>\n              ) : (\n                <TrackableLink\n                  to='/log-in'\n                  trackParams={{\n                    trackInternal: true,\n                    category: 'login',\n                    action: 'click_already_have_account',\n                    context: {\n                      login_email: email || '',\n                      lb_user_id: getCookie(ANALYTIC_COOKIES.LB_USER_ID),\n                    },\n                  }}\n                >\n                  log in\n                </TrackableLink>\n              )}\n            </p>\n          </FormFooter>\n        )}\n      </AuthWrapper>\n    </StyledSignUp>\n  )\n}\n\nexport default SignUp\n\nexport const SignUpQuery = graphql`\n  query SignUp($id: String!) {\n    contentfulAuthenticationPage(id: { eq: $id }) {\n      id\n      slug\n      image {\n        description\n        fluid(maxWidth: 3840) {\n          ...GatsbyContentfulFluid_withWebp\n        }\n      }\n      formHeader {\n        json\n      }\n      formFooter {\n        json\n      }\n      buttonText\n    }\n  }\n`\n"],"sourceRoot":""}